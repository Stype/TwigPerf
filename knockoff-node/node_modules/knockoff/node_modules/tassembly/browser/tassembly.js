!function(s){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=s();else if("function"==typeof define&&define.amd)define([],s);else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.tassembly=s()}}(function(){return function h(l,r,e){function k(a,b){if(!r[a]){if(!l[a]){var d="function"==typeof require&&require;if(!b&&d)return d(a,!0);if(p)return p(a,!0);throw Error("Cannot find module '"+a+"'");}d=r[a]={exports:{}};
l[a][0].call(d.exports,function(c){var b=l[a][1][c];return k(b?b:c)},d,d.exports,h,l,r,e)}return r[a].exports}for(var p="function"==typeof require&&require,q=0;q<e.length;q++)k(e[q]);return k}({1:[function(h,l,r){function e(a){this.protocolRegex=k}var k=RegExp("^(http://|https://|ftp://|irc://|ircs://|gopher://|telnet://|nntp://|worldwind://|mailto:|news:|svn://|git://|mms://|//)","i"),p=/&([A-Za-z0-9\x80-\xff]+);|&\#([0-9]+);|&\#[xX]([0-9A-Fa-f]+);|(&)/;e.prototype.decodeCharReferences=function(a){var b=
this;return a.replace(p,function(a,c,t,f,g){return c?b.decodeEntity(c):t?b.decodeChar(parseInt(t,10)):f?b.decodeChar(parseInt(f,16)):g})};var q=RegExp("[\t ]|\u00ad|\u1806|\u200b|\u2060|\ufeff|\u034f|\u180b|\u180c|\u180d|\u200c|\u200d|[\ufe00-\ufe0f]","g");e.prototype.cssDecodeRE=/\\(?:((?:\n|\r\n|\r|\f))|([0-9A-Fa-f]{1,6})[\x20\t\r\n\f]?|(.)|()$)/;e.prototype.sanitizeStyle=function(a){function b(a,b){var d,g;"'"===b?(d=/'/g,g=/'([^'\n\r\f]*)$/):(d=/"/g,g=/"([^"\n\r\f]*)$/);if(1===(a.match(d)||[]).length%
2)a=a.replace(g,function(a,c){return" "+c});return a}a=this.decodeCharReferences(a);a=a.replace(this.cssDecodeRE,function(a,b,d,g){var e;if(void 0!==b)return"";if(void 0!==d){a=parseInt(d,16);try{e=String.fromCharCode(a)}catch(n){e=a.toString()}}else e=void 0!==g?g:"\\";return"\n"===e||'"'===e||"'"===e||"\\"===e?"\\"+e.charCodeAt(0).toString(16)+" ":e});a=a.replace(/\/\*.*\*\//g," ");a=b(a,"'");a=b(a,'"');var d=a.indexOf("/*");0<=d&&(a=a.substr(0,d));return/[\000-\010\016-\037\177]/.test(a)?"/* invalid control char */":
/expression|filter\s*:|accelerator\s*:|url\s*\(/i.test(a)?"/* insecure input */":a};e.prototype.sanitizeHref=function(a){var b=a.match(/^((?:[a-zA-Z][^:\/]*:)?(?:\/\/)?)([^\/]+)(\/?.*)/),d,c;if(b){if(d=b[1],c=b[2],a=b[3],!d.match(this.protocolRegex))return null}else c=d="";c=c.replace(q,"");return d+c+a};l.exports={AttributeSanitizer:e}},{}],2:[function(h,l,r){function e(){this.uid=0;this.cache={};this.partials={}}function k(a){var b="",d=-1,c="";do{if(/^$|[\[:(,]/.test(c))b+=c,/[pri]/.test(a[d+1])&&
/(?:p(?:[cm]s?)?|r[mc]|i)(?:[\.\)\]}]|$)/.test(a.slice(d+1))&&(b+="c.");else if("'"===c){if(c=a.slice(d).match(/'(?:[^\\']+|\\')*'/))b+=c[0],d+=c[0].length-1}else b+=c;d++;c=a[d]}while(c);return b}function p(a){a=""+a;if(q.test(a))return a=k(a);if(/^'/.test(a))return JSON.stringify(a.slice(1,-1).replace(/\\'/g,"'"));if(/^[cm](?:\.[a-zA-Z_$]*)?$/.test(a))return a;a=k(a);return"(function() { try {return "+a+';} catch (e) { console.error("Error in " + '+JSON.stringify(a)+'+": " + e.toString()); return "";}})()'}
h=new (h("./AttributeSanitizer.js").AttributeSanitizer);e.prototype.attrSanitizer=h;e.prototype._getUID=function(){this.uid++;return this.uid};var q=/^(m|p(?:[cm]s?)?|r[mc]|i|c)\.([a-zA-Z_$]+)$/;e.prototype._evalExpr=function(a,b){var d=this.cache["expr"+a];if(!d){if(d=a.match(q))return b[d[1]][d[2]];if(/^'.*'$/.test(a))return a.slice(1,-1).replace(/\\'/g,"'");d=new Function("c","var m = c.m;return "+k(a));this.cache["expr"+a]=d}if(d)try{return d(b)}catch(c){return console.error("Error while evaluating "+
a),console.error(c),""}return a};e.prototype._getTemplate=function(a,b){if(Array.isArray(a))return a;/^'/.test(a)&&(a=a.slice(1,-1).replace(/\\'/g,"'"));return b.rc.options.partials[a]};e.prototype.ctlFn_foreach=function(a,b){var d=this._evalExpr(a.data,b);if(d&&Array.isArray(d))for(var c=this.compile(this._getTemplate(a.tpl),b),e=d.length,f=this.childContext(null,b),g=0;g<e;g++)f.m=d[g],f.pms[0]=d[g],f.i=g,c(f)};e.prototype.ctlFn_template=function(a,b){var d=this._evalExpr(a.data,b),d=this.childContext(d,
b),c=this._getTemplate(a.tpl,b);c&&this._render(c,d)};e.prototype.ctlFn_with=function(a,b){var d=this._evalExpr(a.data,b),c=this._getTemplate(a.tpl,b);d&&c&&(d=this.childContext(d,b),this._render(c,d))};e.prototype.ctlFn_if=function(a,b){this._evalExpr(a.data,b)&&this._render(a.tpl,b)};e.prototype.ctlFn_ifnot=function(a,b){this._evalExpr(a.data,b)||this._render(a.tpl,b)};e.prototype.ctlFn_attr=function(a,b){var d=this,c;Object.keys(a).forEach(function(e){var f=a[e];"string"===typeof f?c=d._evalExpr(a[e],
b):(c=f.v||"",f.app&&Array.isArray(f.app)&&f.app.forEach(function(a){a["if"]&&d._evalExpr(a["if"],b)&&(c+=a.v||"");a.ifnot&&!d._evalExpr(a.ifnot,b)&&(c+=a.v||"")}),!c&&null===f.v&&(c=null));c&&("href"===e||"src"===e?c=this.attrSanitizer.sanitizeHref(c):"style"===e&&(c=this.attrSanitizer.sanitizeStyle(c)));(c||0===c||""===c)&&b.cb(" "+e+'="'+c.toString().replace(/"/g,"&quot;")+'"')})};e.prototype._xmlEncoder=function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case '"':return"&quot;";
default:return"&#"+a.charCodeAt()+";"}};e.prototype.childContext=function(a,b){return{m:a,pc:b,pm:b.m,pms:[a].concat(b.ps),rm:b.rm,rc:b.rc,cb:b.cb}};e.prototype._assemble=function(a,b){function d(a){e.length&&(c.push("cb("+e.join("+")+");"),e=[]);c.push(a)}var c=[],e=[];c.push("var val;");for(var f=a.length,g=0;g<f;g++){var m=a[g],n=m.constructor;if(n===String)e.push(JSON.stringify(m));else if(n===Array)if(n=m[0],m=m[1],"text"===n)d("val = "+p(m)+';\nval = val || val === 0 ? "" + val : "";\nif(/[<&]/.test(val)) { val = val.replace(/[<&]/g,this._xmlEncoder); }\n'),
e.push("val");else if("attr"===n)for(var n=Object.keys(m),h=0;h<n.length;h++){var k=n[h];if("string"===typeof m[k])c.push("val = "+p(m[k])+";");else{var l=m[k];c.push("val="+JSON.stringify(l.v||""));l.app&&Array.isArray(l.app)&&l.app.forEach(function(a){a["if"]?(c.push("if("+p(a["if"])+"){"),c.push("val += "+JSON.stringify(a.v||"")+";"),c.push("}")):a.ifnot&&(c.push("if(!"+p(a.ifnot)+"){"),c.push("val += "+JSON.stringify(a.v||"")),c.push("}"))});null===l.v&&c.push("if(!val) { val = null; }")}"href"===
k||"src"===k?c.push("if (val) {val = this.attrSanitizer.sanitizeHref(val);}"):"style"===k&&c.push("if (val) {val = this.attrSanitizer.sanitizeStyle(val);}");d('if (val || val === 0 || val === \'\') { \nval = val || val === 0 ? "" + val : "";\nif(/[<&"]/.test(val)) { val = val.replace(/[<&"]/g,this._xmlEncoder); }\ncb('+JSON.stringify(" "+k+'="')+" + val + '\"');}")}else h=this._getUID(),this.cache[h]=m,d("try {"),c.push("this["+JSON.stringify("ctlFn_"+n)+'](this.cache["'+h+'"], c);'),c.push("} catch(e) {"),
c.push("console.error('Unsupported control function:', "+JSON.stringify(n)+", e.stack);"),c.push("}");else console.error("Unsupported type:",m)}d("");return c.join("\n")};e.prototype.render=function(a,b,d){d||(d={});b={rm:b,m:b,pms:[b],rc:null,g:d.globals,cb:d.cb,options:d};b.rc=b;var c="";d.cb||(b.cb=function(a){c+=a});this._render(a,b);if(!d.cb)return c};e.prototype._render=function(a,b){if(a.__cachedFn)return a.__cachedFn(b);for(var d=a.length,c=b.cb,e=0;e<d;e++){var f=a[e],g=f.constructor;if(g===
String)c(f);else if(g===Array){var g=f[0],h=f[1];if("text"===g)f=this._evalExpr(h,b),!f&&0!==f&&(f=""),c((""+f).replace(/[<&]/g,this._xmlEncoder));else try{this["ctlFn_"+g](h,b)}catch(k){console.error("Unsupported control function:",f,k)}}else console.error("Unsupported type:",f)}};e.prototype.compile=function(a,b){var d=this,c=b||{};if(a.__cachedFn)return a.__cachedFn;var e="";c.cb?e+="var m = c.m, cb = c.cb;\n":(e+='var res = "", cb = function(bit) { res += bit; };\nvar m = c;\n',e+="c = { rc: null, rm: m, m: m, pms: [m], g: options.globals, options: options, cb: cb }; c.rc = c;\n");
e+=this._assemble(a,c);c.cb||(e+="return res;");var f=new Function("c","options",e),e=function(a,b){return f.call(d,a,b||c)};return a.__cachedFn=e};l.exports=new e},{"./AttributeSanitizer.js":1}]},{},[2])(2)});
